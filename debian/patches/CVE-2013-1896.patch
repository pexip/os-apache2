Description: fix denial of service via MERGE request
Origin: upstream, http://svn.apache.org/viewvc?view=revision&revision=1497101
Origin: upstream, http://svn.apache.org/viewvc?view=revision&revision=1497212

Index: apache2-2.2.22/modules/dav/main/mod_dav.c
===================================================================
--- apache2-2.2.22.orig/modules/dav/main/mod_dav.c	2013-07-12 08:28:50.666549535 -0400
+++ apache2-2.2.22/modules/dav/main/mod_dav.c	2013-07-12 08:29:07.298550056 -0400
@@ -719,6 +719,12 @@
 
     conf = ap_get_module_config(r->per_dir_config, &dav_module);
     /* assert: conf->provider != NULL */
+    if (conf->provider == NULL) {
+        return dav_new_error(r->pool, HTTP_METHOD_NOT_ALLOWED, 0,
+                             apr_psprintf(r->pool,
+				          "DAV not enabled for %s",
+					  ap_escape_html(r->pool, r->uri)));
+    }
 
     /* resolve the resource */
     err = (*conf->provider->repos->get_resource)(r, conf->dir,
@@ -2655,11 +2661,6 @@
                                   "Destination URI had an error.");
     }
 
-    if (dav_get_provider(lookup.rnew) == NULL) {
-        return dav_error_response(r, HTTP_METHOD_NOT_ALLOWED,
-                                  "DAV not enabled for Destination URI.");
-    }
-
     /* Resolve destination resource */
     err = dav_get_resource(lookup.rnew, 0 /* label_allowed */,
                            0 /* use_checked_in */, &resnew);
